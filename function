// weji-kiskuk.js
// L'nui'suti-flavoured version of the bridge.
// (Same logic as bridge.js, but names & comments live closer to your worldview.)

// Wejitu'ltimk Lnu’k – core word bundle
const LNU_WEJGIJIK = {
  "amu": {
    english: "bee",
    pos: "N-AN",
    sf: "amu",
    lo: "amu",
    semantic_root: "amu – bee / pollinator relative",
    morphological_notes: "base form; plus ji'j = amuji'j (little bee / bee-child).",
    two_eyed:
      "amu msit wen mijua'toq – a small one who feeds many. In science: pollinator. " +
      "In L’nui’suti: a busy relative that keeps plant nations alive."
  },

  "amuji'j": {
    english: "little bee / bee child",
    pos: "N-AN-DIM",
    sf: "amuji'j",
    lo: "amuji'j",
    semantic_root: "amu + ji'j",
    morphological_notes:
      "diminutive/child form of amu; -ji'j marks small/child version of a being.",
    two_eyed:
      "Shows how language marks children not as objects but as small relatives in a line."
  },

  "mia'wj": {
    english: "cat",
    pos: "N-AN",
    sf: "mia'wj",
    lo: "miawji",
    semantic_root: "feline relative",
    morphological_notes: "borrowed form; base for mia'wji'j (kitten).",
    two_eyed:
      "A new animal in the territory, but the language wraps around it in L’nui’suti ways."
  },

  "mia'wji'j": {
    english: "kitten / little cat",
    pos: "N-AN-DIM",
    sf: "mia'wji'j",
    lo: "miawji'j",
    semantic_root: "mia'wj + ji'j",
    morphological_notes:
      "same diminutive pattern as amu → amuji'j; ji'j marks 'little/child'.",
    two_eyed:
      "A kitten is the small one in the cat family, a child-being, not a toy."
  },

  "Netukulimk": {
    english: "balanced way of taking from the land",
    pos: "N-ABSTR",
    sf: "Netukulimk",
    lo: "Netukulimk",
    semantic_root: "taking what you need in a way that lets life continue.",
    morphological_notes:
      "root teaching; used inside Netukulimk'kul (one who lives/practices this).",
    two_eyed:
      "L'nui'suti describes it as kinship and restraint; Western science calls it sustainability."
  },

  "Netukulimk'kul": {
    english: "one who lives Netukulimk / the practice of Netukulimk",
    pos: "N-AGENT",
    sf: "Netukulimk'kul",
    lo: "Netukulimk'gul",
    semantic_root: "Netukulimk + kul (doer/practice).",
    morphological_notes:
      "kul marks 'one who does' / practice; links principle to everyday action.",
    two_eyed:
      "If Netukulimk is the law, Netukulimk'kul is the way your feet keep that law on the ground."
  },

  "Msit No'kmaq": {
    english: "all my relations / all my relatives",
    pos: "EXPR",
    sf: "Msit No'kmaq",
    lo: "Msit No'kmaq",
    semantic_root: "all + my relatives.",
    morphological_notes:
      "names a whole web of beings – human, more-than-human, seen, and unseen.",
    two_eyed:
      "Where Western science might say 'ecosystem', Msit No'kmaq says 'family'."
  },

  "L'nuk": {
    english: "the people (plural of L’nu)",
    pos: "N-PL",
    sf: "L'nuk",
    lo: "Lnu'k",
    semantic_root: "people living within seven generations.",
    morphological_notes:
      "you shared: L’nu is human under seven generations; this keeps that chain.",
    two_eyed:
      "To be L’nu is not just a box to tick. It is being tied to past and future seven."
  },

  "tpuk": {
    english: "late last night",
    pos: "ADV-TIME",
    sf: "tpuk",
    lo: "tpug",
    semantic_root: "time in the back of the night that just passed.",
    morphological_notes: "time-word from lived cycles, not clock numbers.",
    two_eyed:
      "Time as something you feel and live through, not only measure on a device."
  },

  "atel": {
    english: "just now",
    pos: "ADV-TIME",
    sf: "atel",
    lo: "atel",
    semantic_root: "the moment that just happened.",
    morphological_notes: "anchors the story in a living present.",
    two_eyed:
      "Another way to show that Mi’kmaw time is relational: tied to your story, your action."
  },

  "awnasiey": {
    english: "I am nervous",
    pos: "V-STATE-1SG (roughly)",
    sf: "awnasiey",
    lo: "awnasiey",
    semantic_root: "to be in a nervous state.",
    morphological_notes:
      "emotion as a verb/state; you are inside that feeling, not owning it like a thing.",
    two_eyed:
      "A reminder that your spirit, mind, and body move together – feelings are motion."
  },

  "gesig": {
    english: "winter / it is winter",
    pos: "N/STAT",
    sf: "gesig",
    lo: "kesik",
    semantic_root: "winter season being here.",
    morphological_notes:
      "often used as 'winter'; may carry stative force (it is winter now).",
    two_eyed:
      "In L’nui’suti, winter is a character with a job, not only a block on a calendar."
  }
};

// Kisu'lkwey – clean the word
function pjila'sit_form(form) {
  return (form || "").toString().trim().toLowerCase();
}

// Nikan-kiskuk – look at the shape of the word (morphology)
function nikan_mi'kmaw_kejika'timk(formRaw) {
  const form = pjila'sit_form(formRaw);

  // Check for diminutive/child form with -ji'j
  const dimMatch = form.match(/(.+?)ji['’]j$/);
  if (dimMatch) {
    const base = dimMatch[1];
    return {
      wela'lin_type: "diminutive",
      weji_base: base,
      weji_full: form
    };
  }

  return {
    wela'lin_type: "simple",
    weji_base: form,
    weji_full: form
  };
}

// Tan teli-kiskuk – what do we know about this word?
function weji_kiskuk_lnu(queryRaw) {
  const q = pjila'sit_form(queryRaw);
  if (!q) return { wejigijik: [], kejika'timk: null };

  const wejigijik = [];
  const kejika'timk = nikan_mi'kmaw_kejika'timk(q);

  // 1. Wejitu'timk as is (direct key)
  if (LNU_WEJGIJIK[q]) {
    wejigijik.push({
      key: q,
      weji_mitaq: "direct",
      wejitu'timk: LNU_WEJGIJIK[q]
    });
  }

  // 2. Diminutive base form
  if (kejika'timk.wela'lin_type === "diminutive") {
    const base = kejika'timk.weji_base;
    if (LNU_WEJGIJIK[base]) {
      const baseEntry = LNU_WEJGIJIK[base];
      wejigijik.push({
        key: kejika'timk.weji_full,
        weji_mitaq: "diminutive",
        wejitu'timk: {
          ...baseEntry,
          english: `little ${baseEntry.english} / child-${baseEntry.english}`,
          morphological_notes:
            (baseEntry.morphological_notes || "") +
            " · Recognized by the code as -ji'j child/little form."
        }
      });
    }
  }

  // 3. English-side: maybe the one typing is starting in English
  Object.entries(LNU_WEJGIJIK).forEach(([key, entry]) => {
    const gloss = pjila'sit_form(entry.english);
    if (gloss.includes(q) && !wejigijik.find(m => m.key === key)) {
      wejigijik.push({
        key,
        weji_mitaq: "english-gloss",
        wejitu'timk: entry
      });
    }
  });

  return { wejigijik, kejika'timk };
}

// Display helper for the web
function kesalul_bridge_dom(queryRaw) {
  const weji_box = document.getElementById("bridge-results");
  if (!weji_box) return;

  weji_box.innerHTML = "";
  const q = pjila'sit_form(queryRaw);

  if (!q) {
    weji_box.innerHTML =
      "<p>Tapuji-ap. Enter a L’nui’suti form or an English meaning to begin.</p>";
    return;
  }

  const { wejigijik, kejika'timk } = weji_kiskuk_lnu(q);

  if (!wejigijik.length) {
    weji_box.innerHTML =
      "<p>No matches in this small basket yet. Apaji-wla'l, talk to Elders, " +
      "language keepers, and grow this bundle together.</p>";
    return;
  }

  wejigijik.forEach(({ key, weji_mitaq, wejitu'timk }) => {
    const div = document.createElement("article");
    div.className = "card";

    div.innerHTML = `
      <h3>${wejitu'timk.english}</h3>
      <small>Lookup: "${queryRaw}" · ${weji_mitaq}</small>
      <p><span class="badge">Key</span> ${key}</p>
      <p><span class="badge">S/F.O</span> ${wejitu'timk.sf || "—"}</p>
      <p><span class="badge">L.O</span> ${wejitu'timk.lo || "—"}</p>
      <p>${wejitu'timk.morphological_notes || ""}</p>
      <p><strong>Etuaptmumk / Two-Eyed Seeing:</strong> ${wejitu'timk.two_eyed || ""}</p>
    `;

    weji_box.appendChild(div);
  });

  if (kejika'timk && kejika'timk.wela'lin_type === "diminutive") {
    const note = document.createElement("p");
    note.style.fontSize = "0.8rem";
    note.style.color = "#9ca3af";
    note.textContent =
      `L'nui'suti pattern: "${queryRaw}" was seen as base + "-ji'j" (little/child form).`;
    weji_box.appendChild(note);
  }
}

// Hook up to your existing input + button
function nepitu_bridge_ui() {
  const wej_input = document.getElementById("bridge-input");
  const wej_button = document.getElementById("bridge-button");
  if (!wej_input || !wej_button) return;

  const go = () => kesalul_bridge_dom(wej_input.value);
  wej_button.addEventListener("click", go);
  wej_input.addEventListener("keydown", e => {
    if (e.key === "Enter") {
      e.preventDefault();
      go();
    }
  });

  kesalul_bridge_dom("");
}

if (typeof document !== "undefined") {
  document.addEventListener("DOMContentLoaded", nepitu_bridge_ui);
}

if (typeof module !== "undefined") {
  module.exports = {
    LNU_WEJGIJIK,
    nikan_mi'kmaw_kejika'timk,
    weji_kiskuk_lnu
  };
}
